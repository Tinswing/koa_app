{"version":3,"sources":["utils/config.js","utils/validator.js","flux/reducers/authReducer.js","flux/reducers/chat.js","flux/reducers/index.js","flux/store.js","utils/setAuth.js","utils/socket.js","flux/actions/chatActions.js","components/Chat/subpage/Message.js","utils/tools.js","components/Chat/subpage/Contacts.js","components/Chat/subpage/Search.js","components/Chat/subpage/ChatWindow.js","components/Chat/index.js","App.js","index.js"],"names":["config","isEmpty","value","undefined","Object","keys","length","initialState","location","isLogin","user","isVerify","address","shopCar","authReducer","state","arguments","action","type","objectSpread","payload","contacts","messagesNotRead","chatnow","messages","sendingMessages","hideWindow","hideChat","chatReducer","map","i","userId","target","content","concat","toConsumableArray","sender","origin","msg","filter","message","find","notRead","Array","isArray","newMsg","nickname","avatar","m","n","len","push","newState","here","wait","rootReducer","combineReducers","auth","chat","middleWare","thunk","window","localStore","localStorage","getItem","JSON","parse","err","console","error","composeMiddlewares","applyMiddleware","apply","__REDUX_DEVTOOLS_EXTENSION__","store","createStore","compose","setAuthToken","token","axios","defaults","headers","common","setItem","socket","status","initSocket","removeItem","setCurrentUser","ws","close","dispatch","WS_HOST","WebSocket","onopen","e","log","setInterval","send","stringify","onmessage","data","sendChatMessageBackAction","initContacts","receiveChatMessageAction","getContactsAction","onclose","onerror","contactItemToChatAction","item","contactId","getState","HOST","subMessage","replace","substring","connect","messageNotReadItemToChatAction","messageItemToChatAction","props","_react_16_8_5_react_default","a","createElement","className","index","onClick","key","classnames","msg-item-select","style","background","date","year","d","Date","Number","isNaN","getDay","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","formatDate","creaTime","contactClick","online","offline","forEach","isOnline","src","title","Search","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","searchAns","keyword","shakeGetAns","bind","assertThisInitialized","timeout","clearTimeout","setTimeout","setState","get","then","res","success","catch","stopPropagation","_this2","placeholder","onChange","keywordChange","contactsClick","addContactsClick","React","Component","transMessage","images","match","msgs","split","test","ChatWindow","hasError","waitMessage","showChatImage","chatImage","scrollToButton","info","refs","textarea","ondragenter","preventDefault","ondragleave","ondragover","ondrop","file","dataTransfer","files","size","formData","FormData","append","waitImg","innerHTML","post","nowMessage","setWaitMessageAction","document","getElementsByClassName","onclick","img","getAttribute","currentTarget","nextProps","b","now","innerText","msgNow","msgNext","focus","chatMessageBox","scrollTop","scrollHeight","swingChatWindowAction","trim","RegExp","wss","sendingMessageAction","html","sendMessage","display","swingChatWindow","ref","dangerouslySetInnerHTML","__html","id","onInput","textareaInput","contentEditable","suppressContentEditableWarning","onKeyPress","textareaPress","chatImageChange","closeChatImage","hide","Chat","route","width","routeChange","crr-select-bg","subpage_Message","subpage_Contacts","subpage_Search","subpage_ChatWindow","jwtToken","__INITIAL_TOKEN__","Base64","decode","exp","App","src_components_Chat","ReactDOM","render","es","src_App_0","getElementById"],"mappings":"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","file":"static/js/main.eb683c73.chunk.js","sourcesContent":["export default {\r\n //  HOST: 'http://127.0.0.1:5000',\r\n\t// WS_HOST: 'ws://127.0.0.1:5000'\r\n  HOST: 'http://118.126.108.36',\r\n\tWS_HOST: 'ws://118.126.108.36'\r\n}\r\n","export const isEmpty = value => {\r\n\treturn value === undefined || value === null ||\r\n\t\t(typeof value === 'object' && Object.keys(value).length === 0) ||\r\n\t\t(typeof value === 'string' && value.length === 0)\r\n}\r\n\r\nexport const isPhone = number => {\r\n\treturn /^1[0-9]{10}$/.test(number);\r\n}\r\n\r\nexport const isLength = (value, opts) => {\r\n\tif (typeof value !== 'string') return false;\r\n\treturn (value.length >= opts.min && value.length <= opts.max)\r\n}\r\n\r\nexport const isEmail = email => {\r\n  return /^[A-z\\d]+([-_.][A-z\\d]+)*@([A-z\\d]+[-.])+[A-z\\d]{2,4}$/.test(email)\r\n}\r\n","import {isEmpty} from '../../utils/validator'\r\n\r\nvar initialState = {\r\n  location: '',  // 记录路由地址\r\n\tisLogin: false,\r\n\tuser: {},\r\n  isVerify: true,  // 账号验证中\r\n  address: [],  // 收货地址\r\n  shopCar: [],  // 购物车\r\n}\r\nconst authReducer = (state = initialState, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'SET_CURRENT_USER': // 登陆或 App.js 验证 localStorage中 token 时触发\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tisLogin: !isEmpty(action.payload),\r\n\t\t\t\tuser: !isEmpty(action.payload) ? action.payload : {},\r\n        isVerify: false,  // 设置 auth.isVerifu = false (验证结束)\r\n        // address: action.payload.address || []\r\n\t\t\t}\r\n    case 'SET_ROUTER_LOCATION':\r\n      return {\r\n        ...state,\r\n        location: action.payload\r\n      }\r\n    case 'SET_SHOP_CAR':\r\n      return {\r\n        ...state,\r\n        shopCar:action.payload\r\n      }\r\n    case 'SET_ADDRESS':\r\n      return {\r\n        ...state,\r\n        address: action.payload\r\n      }\r\n\t\tdefault:\r\n\t\t\treturn state\r\n\t}\r\n}\r\nexport default authReducer;\r\n","const initialState = {\r\n  contacts: [], // 联系人\r\n  messagesNotRead: [],\r\n  chatnow: undefined,\r\n  messages: [],\r\n  sendingMessages: [/*{\r\n    target: 0,\r\n    message: ''\r\n  }*/],  // 发送中的消息\r\n  hideWindow: true,\r\n  hideChat: true\r\n}\r\n\r\nconst chatReducer = (state = initialState, action) => {\r\n  switch(action.type) {\r\n    case 'SEND_CHAT_MESSAGE_BACK':  // 发送消息回执\r\n      return {\r\n        ...state,\r\n        messages: state.messages.map(i => {\r\n          return i.userId !== action.payload.target ? i : {\r\n            ...i,\r\n            content: [...i.content, {sender: action.payload.origin, msg: action.payload.content}]\r\n          }\r\n        }),\r\n        sendingMessages: state.sendingMessages.filter(i => i.target !== action.payload.target)\r\n      }\r\n    case 'PUT_SENDING_MESSAGE':\r\n      return {\r\n        ...state,\r\n        sendingMessages: [...state.sendingMessages, {target: state.chatnow, message: action.payload}]\r\n      }\r\n    case 'RECEIVE_CHAT_MESSAGE': // 收到聊天消息\r\n      var origin = state.messagesNotRead.find(i => i.userId === action.payload.origin)\r\n      // 聊天人在未读列表中\r\n      if (origin) {\r\n        return {\r\n          ...state,\r\n          messagesNotRead: state.messagesNotRead.map(i => {\r\n            return i.userId === action.payload.origin ? {\r\n              ...i,\r\n              notRead: i.notRead + 1,\r\n              content: [...i.content, {sender: action.payload.origin, msg: action.payload.content}],\r\n            } : i\r\n          })\r\n        }\r\n      }\r\n      origin = state.messages.find(i => i.userId === action.payload.origin)\r\n       // 聊天对象在已读消息列表中\r\n      if (origin) {\r\n         // 是当前聊天对象\r\n        if (origin.userId === state.chatnow) {\r\n          return {\r\n            ...state,\r\n            messages: state.messages.map(i => {\r\n              return i.userId === action.payload.origin ? {\r\n                ...i,\r\n                content: Array.isArray(i.content) ? i.content.concat([{sender: action.payload.origin, msg: action.payload.content}]) : [{sender: action.payload.origin, msg: action.payload.content}]\r\n              } : i\r\n            })\r\n          }\r\n        }else {\r\n          // 不是当前聊天对象，转移到未读列表中\r\n          var newMsg = [{sender: action.payload.origin, msg: action.payload.content}]\r\n          return {\r\n            ...state,\r\n            messages: state.messages.filter(i => i.userId !== action.payload.origin),\r\n            messagesNotRead: [{\r\n              ...origin,\r\n              content: Array.isArray(origin.content) ? origin.content.concat(newMsg) : newMsg,\r\n              notRead: 1,\r\n            }].concat(state.messagesNotRead)\r\n          }\r\n        }\r\n      }\r\n       // 聊天对象新来的\r\n      return {\r\n        ...state,\r\n        messagesNotRead: [{\r\n          userId: action.payload.origin,\r\n          nickname: action.payload.nickname,\r\n          avatar: action.payload.avatar,\r\n          notRead: 1,\r\n          content: [{sender: action.payload.origin, msg: action.payload.content}]\r\n        }].concat(state.messagesNotRead)\r\n      }\r\n    case 'INIT_CONTACTS':\r\n      var m = [], n = [];\r\n      for (let i = 0, len = action.payload.length; i < len; i++) {\r\n        if (action.payload[i].notRead > 0) {\r\n          n.push(action.payload[i])\r\n        }else {\r\n          m.push(action.payload[i])\r\n        }\r\n      }\r\n      return {\r\n        ...state,\r\n        messagesNotRead: n,\r\n        messages: m\r\n      }\r\n\r\n    case 'MESSAGE_NOT_READ_ITEM_TO_CHAT': // 未读消息到聊天窗口\r\n      return {\r\n        ...state,\r\n        chatnow: action.payload.userId,\r\n        messagesNotRead: state.messagesNotRead.filter(i => i.userId !== action.payload.userId),\r\n        messages: [action.payload].concat(state.messages),\r\n        hideWindow: false\r\n      }\r\n    case 'CONTACT_ITEM_TO_CHAT': // 联系人和找人 item 到聊天窗口\r\n      var newState = {\r\n        ...state,\r\n        chatnow: action.payload.userId,\r\n        hideWindow: false,\r\n        hideChat: false,\r\n        messagesNotRead: state.messagesNotRead.filter(i => {\r\n          var here = i.userId !== action.payload.userId\r\n            if (!here) {\r\n              action.payload.content = i.content\r\n            }\r\n          return here\r\n        }),\r\n        messages: state.messages.filter(i => {\r\n          var here = i.userId !== action.payload.userId\r\n          if (!here) {\r\n            action.payload.content = i.content\r\n          }\r\n          return here\r\n        })\r\n      }\r\n      // 聊天人已在消息列表中\r\n      if (newState.messagesNotRead.length !== state.messagesNotRead.length || newState.messages.length !== state.messages.length) {\r\n        return {\r\n          ...newState,\r\n          messages: [action.payload].concat(newState.messages)\r\n        }\r\n      }\r\n      // 不在消息列表中\r\n      action.payload.content = []\r\n      return {\r\n        ...newState,\r\n        messages: [action.payload].concat(state.messages)\r\n      }\r\n\r\n    case 'MESSAGE_ITEM_TO_CHAT':  // 已读消息到窗口\r\n      return {\r\n        ...state,\r\n        chatnow: action.payload.userId,\r\n        hideWindow: false\r\n      }\r\n    case 'SET_CONTACTS':  // 获得联系人\r\n      return {\r\n        ...state,\r\n        contacts: action.payload\r\n      }\r\n    case 'SET_WAIT_MESSAGE':\r\n      return {\r\n        ...state,\r\n        messages: state.messages.map(i => {\r\n          return i.userId === state.chatnow ? {...i, wait: action.payload} : i\r\n        })\r\n      }\r\n    case 'TOGGLE_CHAT':\r\n      return {\r\n        ...state,\r\n        hideChat: action.payload\r\n      }\r\n    case 'SWING_CHAT_WINDOW':\r\n      return {\r\n        ...state,\r\n        hideWindow: action.payload\r\n      }\r\n    case 'LOGIN_OUT_CHAT':\r\n      return initialState\r\n    default:\r\n      return state\r\n  }\r\n}\r\nexport default chatReducer\r\n","/**\r\n * 合并多个 reducer 成一个大的reducer\r\n */\r\n\r\nimport {combineReducers} from 'redux'\r\n\r\n// import register from './register'\r\nimport auth from './authReducer'\r\n// import product from './product'\r\n// import order from './order'\r\nimport chat from './chat'\r\n// import messageBox from './messageBox'\r\n\r\nlet rootReducer = combineReducers({\r\n\tauth,\r\n  chat,\r\n  // register,\r\n  // product,\r\n  // order,\r\n  // messageBox\r\n});\r\nexport default rootReducer;\r\n","import {createStore, applyMiddleware, compose} from 'redux'\r\nimport thunk from 'redux-thunk'\r\n\r\nimport rootReducer from './reducers/index.js'\r\n\r\nlet middleWare = [thunk];\r\nlet initialState = {};\r\n// 从本地储存获取 store 初始状态\r\nif (typeof(window) === 'object') {\r\n  var localStore = window.localStorage.getItem('localStoreState')\r\n  if (localStore) {\r\n    try {\r\n      initialState = JSON.parse(localStore)\r\n    }catch(err) {\r\n      console.error(err)\r\n    }\r\n  }\r\n}\r\n\r\n// 需要合并的中间件\r\nlet composeMiddlewares = [applyMiddleware(...middleWare),];\r\n//激活 chrome 浏览器 redux 插件\r\nif (typeof window === 'object' && window.__REDUX_DEVTOOLS_EXTENSION__) {\r\n\tcomposeMiddlewares.push(window.__REDUX_DEVTOOLS_EXTENSION__())\r\n}\r\nconst store = createStore(rootReducer, initialState, compose(...composeMiddlewares));\r\n\r\n// 订阅更新函数，每次状态更新都会执行\r\n// store.subscribe(() => {\r\n\r\n// })\r\n\r\nexport default store;\r\n","import axios from 'axios'\r\nimport store from '../flux/store'\r\nimport socket from './socket'\r\nimport { isEmpty } from '../utils/validator'\r\n\r\nexport const setAuthToken = token => {\r\n\tif (token) {\r\n\t\t// 让每个请求头携带 token\r\n\t\taxios.defaults.headers.common[\"Authorization\"] = token;\r\n\t\t // 添加localStorage 储存token\r\n\t\twindow.localStorage.setItem(\"jwtToken\", token);\r\n    // 初始化 websocket\r\n    if (socket.status === 'close') {\r\n      socket.initSocket(token)\r\n    }\r\n\t} else {\r\n\t\t// 删除请求头 token\r\n\t\tdelete axios.defaults.headers.common[\"Authorization\"];\r\n\t\t// 删除localStorage储存的 token\r\n\t\twindow.localStorage.removeItem(\"jwtToken\");\r\n\t}\r\n}\r\n\r\nexport const setCurrentUser = user => {\r\n  if (isEmpty(user)) {\r\n    if (socket.status === 'open') {\r\n      socket.ws.close()\r\n    }\r\n    store.dispatch({ type: 'LOGIN_OUT_CHAT' })\r\n  }\r\n\tstore.dispatch({\r\n\t\ttype: 'SET_CURRENT_USER',\r\n\t\tpayload: user\r\n\t})\r\n}\r\n\r\n","import { setAuthToken } from './setAuth'\r\nimport {\r\n  // setWaitMessageAction,\r\n  sendChatMessageBackAction,\r\n  receiveChatMessageAction,\r\n  getContactsAction,\r\n  initContacts\r\n} from '../flux/actions/chatActions'\r\nimport config from './config'\r\n\r\nconst WS_HOST = config.WS_HOST\r\n\r\nconst socket = {\r\n  status: 'close',\r\n  ws: null,\r\n  initSocket: function (token) {\r\n    if (typeof(window) !== 'object' || !token) return;\r\n    const ws = new WebSocket(`${WS_HOST}?token=${token}`)\r\n\r\n    ws.onopen = function(e) {\r\n      console.log('socket open')\r\n      socket.status = 'open'\r\n      setInterval(function() {  // 设置定时器更新 token\r\n        if (socket.status !== 'open') { return }\r\n        ws.send(JSON.stringify({\r\n          type: 'transToken',\r\n          target: 'koa'\r\n        }))\r\n      }, 1000*60*15)\r\n      ws.send('{\"type\":\"init_chat_messages\"}') // 获取聊天信息\r\n    }\r\n\r\n    ws.onmessage = function(e) {\r\n      var msg = e.data\r\n      try {\r\n        msg = JSON.parse(msg)\r\n      }catch(err) {\r\n        return\r\n      }\r\n      switch(msg.type) {\r\n        case 'transToken':\r\n          return setAuthToken(msg.content)\r\n\r\n        case 'send_chat_message':  // 发送消息后回执\r\n          return sendChatMessageBackAction(msg)\r\n\r\n        case 'init_chat_messages':  // 初始化聊天信息\r\n          return initContacts(msg.content)\r\n\r\n        case 'receive_chat_message':  // 收到聊天消息\r\n          return receiveChatMessageAction(msg)\r\n\r\n        case 'get_contacts': // 收到联系人列表信息\r\n          return getContactsAction(msg.content)\r\n        default:\r\n          return\r\n      }\r\n    }\r\n\r\n    ws.onclose = function(e) {\r\n      console.log('socket close!')\r\n      socket.status = 'close'\r\n    }\r\n\r\n    ws.onerror = function(e) {\r\n      console.error('socket error', e)\r\n    }\r\n\r\n    socket.ws = ws\r\n  }\r\n}\r\n\r\nexport default socket\r\n","import store from '../store'\r\nimport socket from '../../utils/socket'\r\n\r\nexport const toggleChatAction = state => { // 隐藏或显示聊天窗口\r\n  store.dispatch({\r\n    type: 'TOGGLE_CHAT',\r\n    payload: state\r\n  })\r\n}\r\n\r\nexport const initContacts = messages => {\r\n  store.dispatch({\r\n    type: 'INIT_CONTACTS',\r\n    payload: messages\r\n  })\r\n}\r\n\r\n// 点击未读消息展示到聊天框\r\nexport const messageNotReadItemToChatAction = item => dispatch => {\r\n  return function() {\r\n    if (socket.status === 'open') {\r\n      socket.ws.send(JSON.stringify({ // 设置消息已读\r\n        type: 'msg_be_read',\r\n        content: item.userId\r\n      }))\r\n    }\r\n    dispatch({\r\n      type: 'MESSAGE_NOT_READ_ITEM_TO_CHAT',\r\n      payload: item\r\n    })\r\n  }\r\n}\r\n\r\nexport const sendingMessageAction = msg => dispatch => {\r\n  dispatch({\r\n    type: 'PUT_SENDING_MESSAGE',\r\n    payload: msg\r\n  })\r\n}\r\n\r\n// 点击已读消息展示到聊天框\r\nexport const messageItemToChatAction = item => dispatch => {\r\n  return function() {\r\n    dispatch({\r\n      type: 'MESSAGE_ITEM_TO_CHAT',\r\n      payload: item\r\n    })\r\n  }\r\n}\r\n\r\n// 点击联系人和找人 item 到聊天框\r\nexport const contactItemToChatAction = item => {\r\n  item = {...item, userId: item.userId || item.contactId}\r\n  var chat = store.getState().chat\r\n  if (chat.chatnow === item.userId && !chat.hideChat) return;\r\n\r\n  store.dispatch({\r\n    type: 'CONTACT_ITEM_TO_CHAT',\r\n    payload: item\r\n  })\r\n}\r\n\r\nexport const swingChatWindowAction = hide => dispatch => {\r\n  dispatch({\r\n    type: 'SWING_CHAT_WINDOW',\r\n    payload: hide\r\n  })\r\n}\r\n\r\nexport const setWaitMessageAction = msg => dispatch => {\r\n  dispatch({\r\n    type: 'SET_WAIT_MESSAGE',\r\n    payload: msg\r\n  })\r\n}\r\n\r\n// 发送消息后回执\r\nexport const sendChatMessageBackAction = message => {\r\n  store.dispatch({\r\n    type: 'SEND_CHAT_MESSAGE_BACK',\r\n    payload: message\r\n  })\r\n}\r\n\r\n// 收到聊天消息\r\nexport const receiveChatMessageAction = message => {\r\n  if (message.origin === store.getState().chat.chatnow && socket.status === 'open') {\r\n    socket.ws.send(JSON.stringify({\r\n      type: 'msg_be_read',\r\n      content: message.origin\r\n    }))\r\n  }\r\n  store.dispatch({\r\n    type: 'RECEIVE_CHAT_MESSAGE',\r\n    payload: message\r\n  })\r\n}\r\n\r\n// 收到联系人列表\r\nexport const getContactsAction = contacts => {\r\n  store.dispatch({\r\n    type: 'SET_CONTACTS',\r\n    payload: contacts\r\n  })\r\n}\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport classnames from 'classnames'\r\nimport config from '../../../utils/config'\r\nimport { formatDate } from '../../../utils/tools'\r\n\r\nimport { messageNotReadItemToChatAction, messageItemToChatAction } from '../../../flux/actions/chatActions'\r\nconst HOST = config.HOST\r\n\r\nfunction subMessage(message) {\r\n  var msg = message.replace(/{{=\\w+\\.(jpg|png|icon|gif|jpeg)}}/g, '【图片】').replace('&lt;', '<').replace('&gt;', '>')\r\n  return message.length < 19 ? msg : msg.substring(0,18) + '...'\r\n}\r\n\r\nconst Message = props => {\r\n  return (\r\n    <div className=\"chat-msg-wrap\">\r\n      { // 未读消息\r\n        [props.messagesNotRead.map((item, index) => (\r\n          <div onClick={props.messageNotReadItemToChatAction(item)} key={index} className={classnames(\"msg-item\", {\r\n              'msg-item-select': item.userId === props.chatnow\r\n            })}>\r\n            <div className=\"msg-i-userwrap\">\r\n              <div className=\"msg-i-avatar\" style={{\r\n                background: `url(${HOST}/image/member/avatar/${item.avatar}) center center / 35px 35px no-repeat`\r\n              }}></div>\r\n              <div className=\"msg-i-nickname\">{item.nickname}</div>\r\n            </div>\r\n            <div className=\"msg-i-wrap\">\r\n              <div className=\"msg-i-disone\">{(Array.isArray(item.content) && item.content.length > 0 ? subMessage(item.content[item.content.length-1].msg) : '')}</div>\r\n              <div className=\"msg-i-len\">{item.notRead}</div>\r\n            </div>\r\n              <div className=\"msg-i-time\">{Array.isArray(item.content) && item.content.length > 0 ? formatDate(item.content[item.content.length-1].creaTime) : ''}</div>\r\n          </div>\r\n        )), // 已读消息\r\n          props.messages.map((item, index) => (\r\n            <div onClick={props.messageItemToChatAction(item)} key={index} className={classnames(\"msg-item\", {\r\n              'msg-item-select': item.userId === props.chatnow\r\n            })}>\r\n              <div className=\"msg-i-userwrap\">\r\n                <div className=\"msg-i-avatar\" style={{\r\n                  background: `url(${HOST}/image/member/avatar/${item.avatar}) center center / 35px 35px no-repeat`\r\n                }}></div>\r\n                <div className=\"msg-i-nickname\">{item.nickname}</div>\r\n              </div>\r\n              <div className=\"msg-i-wrap\">\r\n                <div className=\"msg-i-disone\">{props.chatnow !== item.userId && item.wait ? subMessage(item.wait) : (Array.isArray(item.content) && item.content.length > 0 ? subMessage(item.content[item.content.length-1].msg) : '')}</div>\r\n              </div>\r\n            </div>\r\n          ))\r\n        ]\r\n      }\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n  return {\r\n    messagesNotRead: Array.isArray(state.chat.messagesNotRead) ? state.chat.messagesNotRead : [],\r\n    messages: Array.isArray(state.chat.messages) ? state.chat.messages : [],\r\n    chatnow: state.chat.chatnow\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, { messageNotReadItemToChatAction, messageItemToChatAction })(Message)\r\n","// 将两个数转换成整数相乘\r\nexport const intMultiplication = function (a, b) {\r\n  a = a+''\r\n  b = b+''\r\n  var deci = 0  // 2个操作数的小数位数\r\n  // 判断是否小数\r\n  if (/^\\d+\\.\\d+$/.test(a)) {\r\n    deci += a.replace(/^\\d+\\.(?=\\d+$)/, '').length\r\n    a = a.replace('.', '')\r\n  }\r\n  if (/^\\d+\\.\\d+$/.test(b)) {\r\n    deci += b.replace(/^\\d+\\.(?=\\d+$)/, '').length\r\n    b = b.replace('.', '')\r\n  }\r\n  var result = (Number(a) * Number(b)) + ''\r\n  return deci > 0 ? result.substring(0, result.length - deci) + '.' + result.substring(result.length - deci) : result\r\n}\r\n\r\n// 将两个数转换成整数相加\r\nexport const intAdd = function (a, b) {\r\n  a = a + ''\r\n  b = b + ''\r\n  var deci1 = 0;\r\n  var deci2 = 0;\r\n  if (/^\\d+\\.\\d+$/.test(a)) {\r\n    deci1 = a.replace(/^\\d+\\.(?=\\d+$)/, '').length\r\n    a = a.replace('.', '')\r\n  }\r\n  if (/^\\d+\\.\\d+$/.test(b)) {\r\n    deci2 += b.replace(/^\\d+\\.(?=\\d+$)/, '').length\r\n    b = b.replace('.', '')\r\n  }\r\n  if (deci1 !== deci2) {\r\n    for (var i = 0, len = Math.abs(deci1 - deci2); i < len; i++) {\r\n    if (deci1 < deci2) {\r\n      a += '0'\r\n    }else {\r\n      b += '0'\r\n    }\r\n    }\r\n  }\r\n  var result = Number(a) + Number(b) + ''\r\n  var maxDeci = Math.max(deci1, deci2)\r\n  return maxDeci !== 0 ? result.substring(0, result.length - maxDeci) + '.' + result.substring(result.length - maxDeci) : result\r\n}\r\n\r\nexport const transPrice = function (price) {\r\n  return /^\\d+$/.test(price) ? price + '.00' :  // 没有小数\r\n  /^\\d+\\.\\d$/.test(price) ? price + '0' : price  // 一位小数\r\n}\r\n\r\nexport const formatDate = function(date, year) {\r\n  const d = new Date(date)\r\n  if (Number.isNaN(d.getDay())) {\r\n    return ''\r\n  }\r\n  var format = year ? d.getFullYear() + '-' : ''\r\n\r\n  return (format + (d.getMonth() + 1) + '-' +\r\n    d.getDate() + ' ' +\r\n    d.getHours() + ':' +\r\n    d.getMinutes() + ':' +\r\n    d.getSeconds())\r\n}\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport { contactItemToChatAction } from '../../../flux/actions/chatActions'\r\nimport socket from '../../../utils/socket'\r\nimport config from '../../../utils/config'\r\nconst HOST = config.HOST\r\n\r\n// 点击联系人到聊天框\r\nfunction contactClick(item) {\r\n  return function() {\r\n    contactItemToChatAction(item)\r\n  }\r\n}\r\n\r\nconst Contacts = (props) => {\r\n  if (socket.status === 'open') {\r\n    socket.ws.send(JSON.stringify({\r\n      type: 'get_contacts'\r\n    }))\r\n  }\r\n  const online = []\r\n  const offline = []\r\n  props.contacts.forEach(i => {\r\n    if (i.isOnline) {\r\n      online.push(i)\r\n    }else {\r\n      offline.push(i)\r\n    }\r\n  })\r\n  return (\r\n    <div>\r\n      {\r\n        props.contacts.length < 1 ? <div>你还没有联系人哦...</div> :\r\n        [\r\n          online.map((item, index) => (\r\n            <div key={index} onClick={contactClick(item)} className=\"chat-contact-item\">\r\n              <div className=\"chatcon-il\"><img src={`${HOST}/image/member/avatar/${item.avatar}`}/></div>\r\n              <p title={item.nickname} className=\"chatcon-ir\">{item.nickname}</p>\r\n            </div>\r\n          )),\r\n          offline.map((item, index) => (\r\n            <div key={index} onClick={contactClick(item)} className=\"chat-contact-item chat-item-offline\">\r\n              <div className=\"chatcon-il\"><img src={`${HOST}/image/member/avatar/${item.avatar}`}/></div>\r\n              <p title={item.nickname} className=\"chatcon-ir\">{item.nickname}</p>\r\n            </div>\r\n          ))\r\n        ]\r\n      }\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\n// class Contacts extends React.Component {\r\n//   componentWillMount() {\r\n//     // socket 请求 联系人列表\r\n//     if (socket.status === 'open') {\r\n//       socket.ws.send(JSON.stringify({\r\n//         type: 'get_contacts'\r\n//       }))\r\n//     }\r\n//   }\r\n//   // 点击联系人到聊天框\r\n//   contactClick(item) {\r\n//     contactItemToChatAction(item)\r\n//   }\r\n//   render() {\r\n//     const online = []\r\n//     const offline = []\r\n//     this.props.contacts.forEach(i => {\r\n//       if (i.isOnline) {\r\n//         online.push(i)\r\n//       }else {\r\n//         offline.push(i)\r\n//       }\r\n//     })\r\n//     return (\r\n//       <div>\r\n//         {\r\n//           this.props.contacts.length < 1 ? <div>你还没有联系人哦...</div> :\r\n//           [\r\n//             online.map((item, index) => (\r\n//               <div key={index} onClick={this.contactClick.bind(this, item)} className=\"chat-contact-item\">\r\n//                 <div className=\"chatcon-il\"><img src={`${HOST}/image/member/avatar/${item.avatar}`}/></div>\r\n//                 <p title={item.nickname} className=\"chatcon-ir\">{item.nickname}</p>\r\n//               </div>\r\n//             )),\r\n//             offline.map((item, index) => (\r\n//               <div key={index} onClick={this.contactClick.bind(this, item)} className=\"chat-contact-item chat-item-offline\">\r\n//                 <div className=\"chatcon-il\"><img src={`${HOST}/image/member/avatar/${item.avatar}`}/></div>\r\n//                 <p title={item.nickname} className=\"chatcon-ir\">{item.nickname}</p>\r\n//               </div>\r\n//             ))\r\n//           ]\r\n//         }\r\n//       </div>\r\n//     )\r\n//   }\r\n// }\r\nfunction mapStateToProps(state) {\r\n  return {\r\n    contacts: Array.isArray(state.chat.contacts) ? state.chat.contacts : []\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps)(Contacts)\r\n","import React from 'react'\r\nimport axios from 'axios'\r\nimport config from '../../../utils/config'\r\nimport socket from '../../../utils/socket'\r\nimport { contactItemToChatAction } from '../../../flux/actions/chatActions'\r\n\r\nconst HOST = config.HOST\r\n\r\nclass Search extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      searchAns: [],\r\n      keyword: '',\r\n      message: ''\r\n    }\r\n    this.shakeGetAns = this.shakeGetAns().bind(this)\r\n  }\r\n\r\n  // 防抖获取结果\r\n  shakeGetAns() {\r\n    var timer = 0\r\n    var timeout = -1;\r\n    return function(keyword) {\r\n      var _this = this\r\n      clearTimeout(timeout) // 清除前一个定时器\r\n      timeout = setTimeout(function() {\r\n        _this.setState({\r\n          message: '搜索中...'\r\n        })\r\n        axios.get(`${HOST}/api/users/search_contacts?keyword=${_this.state.keyword}`)\r\n          .then(res => {\r\n            if (res.data.success) {\r\n              _this.setState({\r\n                searchAns: res.data.payload,\r\n                message: res.data.payload.length === 0 ? '未搜索到联系人...' : ''\r\n              })\r\n            }\r\n          })\r\n          .catch(err => {\r\n            console.error(err)\r\n          })\r\n      }, 1000)\r\n    }\r\n  }\r\n\r\n  keywordChange(e) {\r\n    var _this = this\r\n    var keyword = e.target.value\r\n    this.setState({\r\n      keyword\r\n    }, function() {\r\n      _this.shakeGetAns(keyword)\r\n    })\r\n  }\r\n\r\n  contactsClick(item) {\r\n    contactItemToChatAction(item)\r\n  }\r\n\r\n  addContactsClick(item) {\r\n    return function(e) {\r\n      e.stopPropagation()\r\n      if (socket.status === 'open') {\r\n        socket.ws.send(JSON.stringify({\r\n          type: 'add_contacts',\r\n          content: item.userId\r\n        }))\r\n        this.setState({\r\n          searchAns: this.state.searchAns.filter(i => i.userId !== item.userId)\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"chat-search-wrap\">\r\n        <div className=\"chat-s-input\">\r\n          <div className=\"chat-s-i-l\"><input value={this.state.keyword} placeholder=\"输入联系人昵称\" onChange={this.keywordChange.bind(this)} type=\"text\"/></div>\r\n          <div className=\"chat-s-i-r\">点击搜索</div>\r\n        </div>\r\n        <div className=\"chat-s-ans\">\r\n          {\r\n            Array.isArray(this.state.searchAns) && this.state.searchAns.length === 0 ? <div className=\"con-search-miss\">{this.state.message}</div> : this.state.searchAns.map((item, index) => (\r\n              <div onClick={this.contactsClick.bind(this, item)} className=\"c-s-item\" key={index}>\r\n                <div className=\"c-s-i-avatar\"><img src={`${HOST}/image/member/avatar/${item.avatar}`} /></div>\r\n                <div className=\"c-s-i-nickname\">{item.nickname}</div>\r\n                <div onClick={this.addContactsClick(item).bind(this)} className=\"c-s-i-btn-add\">加好友</div>\r\n              </div>\r\n            ))\r\n          }\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Search\r\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport PropTypes from 'prop-types'\nimport axios from 'axios'\n\nimport config from '../../../utils/config'\nimport wss from '../../../utils/socket'\nimport { swingChatWindowAction, setWaitMessageAction, sendingMessageAction } from '../../../flux/actions/chatActions'\nconst HOST = config.HOST\n\n// function readFile(file, callback) {\n//   var reader = new FileReader()\n//   //以二进制形式读取文件\n//   reader.readAsArrayBuffer(file)\n//   reader.onload = function(e) {\n//     callback(e.target.result)\n//   }\n// }\n\nfunction transMessage(msg) {\n  if (msg === '' || typeof(msg) !== 'string') return msg\n    // firefox 不支持正则前置断言\n    // images = msg.match(/(?<!{{=)\\w+\\.(jpg|jpeg|gif|png|icon)(?=}})/g)\n  var images = msg.match(/[A-z0-9]{10}_\\d{8}\\.(jpg|jpeg|gif|png|ico)(?=}})/g)\n  if (images) {\n    // var msgs = msg.split(/{{\\=[A-z0-9]{10}_\\d{8}\\.(jpg|jpeg|gif|png|ico)}}/)\n    var msgs = msg.split(/{{\\=[A-z0-9]{10}_\\d{8}\\.[jpgenifco]{3,4}}}/i)\n    msg = msgs[0]\n    for (var i = 1, len = msgs.length; i < len; i++) {\n      msg += `<img chat=\"${images[i-1]}\" src=\"${HOST}/image/member/chat/${/\\.gif$/.test(images[i-1]) ? images[i-1] : images[i-1] + '_w80.jpg'}\">${msgs[i]}`\n    }\n  }\n  return msg\n}\n\nclass ChatWindow extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      hasError: false,\n      message: '',\n      waitMessage: '',\n      showChatImage: false,\n      chatImage: ''\n    }\n    this.scrollToButton = this.scrollToButton.bind(this)\n  }\n\n  static getDerivedStateFromError(error) {\n    // console.log(error)\n    return { hasError: true };\n  }\n\n  componentDidCatch(error, info) {\n    // console.log(error, info)\n    // logErrorToMyService(error, info);\n  }\n\n  componentDidMount() {\n    if (typeof(window) !== 'object') return;\n    this.refs.textarea.ondragenter = function (e) {\n      e.preventDefault()\n    }\n    this.refs.textarea.ondragleave = function(e) {\n      e.preventDefault()\n    }\n    this.refs.textarea.ondragover = function(e) {\n        e.preventDefault();\n    }\n    var _this = this\n    this.refs.textarea.ondrop = function(e) {\n      e.preventDefault()\n      e.stopPropagation() // 火狐浏览器，拖动时打开新页面\n      if (!_this.props.chat.chatnow) return;\n      var file = e.dataTransfer.files[0]\n      if (!file || file.size > '5048576‬') {\n        return; // 5M 以下的文件\n      }else if (!/^image\\/(jpeg|png|gif|x-icon)$/.test(file.type)) {\n        return; // 不支持的格式\n      }\n      var formData = new FormData()\n      formData.append('picture', file)\n      var waitImg = `<waitimg size=\"${file.size}\"><img src=\"${HOST}/image/ui/wait.gif\"></waitimg>`\n      _this.setState({\n        waitMessage: _this.refs.textarea.innerHTML += waitImg\n      })\n\n      axios.post(`${HOST}/api/users/save_chat_image`, formData)\n        .then(res => {\n          if (res.data.success) {//new RegExp(`<waitimg size=\"${file.size}\">[\\\\d\\\\D]+</waitimg>`)\n            var nowMessage = _this.refs.textarea.innerHTML.replace(waitImg,`<img src=\"${HOST}/image/member/chat/${res.data.payload}_w80.jpg\">`)\n            return _this.setState({\n              waitMessage: nowMessage\n            }, function() {\n              _this.props.setWaitMessageAction(nowMessage)\n            })\n\n          }\n          // 失败了\n          _this.setState({\n            waitMessage: _this.refs.textarea.innerHTML.replace(waitImg, '')\n          })\n        })\n        .catch(err => {\n          console.error(err)\n          _this.setState({\n            waitMessage: _this.refs.textarea.innerHTML.replace(waitImg, '')\n          })\n        })\n    }\n    document.getElementsByClassName(\"chatw-show-wrap\")[0].onclick = function(e) {\n      var img = e.target.getAttribute('chat')\n      if (img && /^\\w{10}_\\d{7,9}\\.(jpg|png|gif|icon|jpeg)$/.test(img)) {\n        _this.setState({\n          showChatImage: true,\n          chatImage: img\n        })\n      }\n    }\n  }\n\n  chatImageChange(e) {\n    var _this = this\n    if (!_this.props.chat.chatnow) return;\n    var file = e.currentTarget.files[0]\n    if (!file || file.size > '5048576‬') {\n      return; // 5M 以下的文件\n    }else if (!/^image\\/(jpeg|png|gif|x-icon)$/.test(file.type)) {\n      return; // 不支持的格式\n    }\n    var formData = new FormData()\n    formData.append('picture', file)\n    var waitImg = `<waitimg size=\"${file.size}\"><img src=\"${HOST}/image/ui/wait.gif\"></waitimg>`\n    _this.setState({\n      waitMessage: _this.refs.textarea.innerHTML += waitImg\n    })\n\n    axios.post(`${HOST}/api/users/save_chat_image`, formData)\n      .then(res => {\n        if (res.data.success) {//new RegExp(`<waitimg size=\"${file.size}\">[\\\\d\\\\D]+</waitimg>`)\n          var nowMessage = _this.refs.textarea.innerHTML.replace(waitImg,`<img src=\"${HOST}/image/member/chat/${res.data.payload}_w80.jpg\">`)\n          return _this.setState({\n            waitMessage: nowMessage\n          }, function() {\n            _this.props.setWaitMessageAction(nowMessage)\n          })\n\n        }\n        // 失败了\n        _this.setState({\n          waitMessage: _this.refs.textarea.innerHTML.replace(waitImg, '')\n        })\n      })\n      .catch(err => {\n        console.error(err)\n        _this.setState({\n          waitMessage: _this.refs.textarea.innerHTML.replace(waitImg, '')\n        })\n      })\n\n  }\n\n  componentWillUnmount() {\n    if (typeof(window) !== 'object') return;\n    this.refs.textarea.ondragenter = null\n    this.refs.textarea.ondragleave = null\n    this.refs.textarea.ondragover = null\n    this.refs.textarea.ondrop = null\n  }\n\n  // 聊天对象改变时，拿出未发送消息\n  componentWillReceiveProps(nextProps, b) {\n    // console.log(nextProps, b)\n    if (typeof(window) !== 'object') { return }\n    var chat = this.props.chat\n    // 将消息中的 wait 提取出\n    if (chat.chatnow !== nextProps.chat.chatnow) {\n      var now = nextProps.chat.messages.find(i => i.userId === nextProps.chat.chatnow)\n      if (now && now.wait) {\n        // this.refs.textarea.classList.remove('textarea-f1')\n        this.refs.textarea.innerHTML = now.wait\n      }else {\n        this.refs.textarea.innerText = ''\n      }\n      // 将消息滚动条，到最低\n      this.scrollToButton()\n    }else {\n      var msgNow = chat.messages.find(i => i.userId === chat.chatnow)\n      var msgNext = nextProps.chat.messages.find(i => i.userId === nextProps.chat.chatnow)\n      if (msgNow && msgNext && Array.isArray(msgNow.content) && Array.isArray(msgNext.content) && msgNow.content.length !== msgNext.content.length) {\n        // 将消息滚动条，到最低\n        this.scrollToButton()\n      }\n    }\n    this.refs.textarea.focus()\n  }\n\n  scrollToButton() {\n      var _this = this\n        // 这里 render 还没执行，页面中组件\n      setTimeout(function() {\n        // console.log(_this.refs.chatMessageBox.scrollTop, _this.refs.chatMessageBox.scrollHeight)\n        _this.refs.chatMessageBox.scrollTop = _this.refs.chatMessageBox.scrollHeight\n        setTimeout(function() {\n        // console.log(_this.refs.chatMessageBox.scrollTop, _this.refs.chatMessageBox.scrollHeight)\n          _this.refs.chatMessageBox.scrollTop = _this.refs.chatMessageBox.scrollHeight\n        }, 200)\n      }, 100)\n  }\n\n  closeChatImage() {\n    this.setState({\n      showChatImage: false,\n      chatImage: ''\n    })\n  }\n\n  // 隐藏这个窗口\n  swingChatWindow() {\n    this.props.swingChatWindowAction(true)\n  }\n\n  sendMessage() {\n    var message = this.refs.textarea.innerHTML.trim().replace(new RegExp(`<waitimg>[\\\\d\\\\D]+</waitimg>`), '')\n    if (message === '' || !this.props.chat.chatnow) return;\n    // var images = message.match(/\\w+?\\.(gif|png|jpg|jpeg|ico)(?=_w80\\.jpg\">)/g)\n    // 取出图片\n    var images = message.match(/[A-z0-9]{10}_\\d{8}\\.(gif|png|jpg|jpeg|ico)(?=_w80\\.jpg\")/g)\n\n    if (images) {\n      var msgs = message.split(/<img [\\w\\W]+?>/) // 根据图片分割消息，非贪婪匹配\n      // console.log(msgs)\n      message = msgs[0]\n      for (var i = 1, len = msgs.length; i < len; i++) {\n        message += `{{=${images[i-1]}}}${msgs[i]}`\n      }\n    }\n    message = message.replace(/<(span|font|div|br|img)[\\d\\D]*?>/g, '').replace(/<\\/(div|span|font)>/g, '').replace(/&nbsp;/g, ' ').replace(/</g, '&lt;').replace(/>/g, '&gt;')\n    // console.log(images)\n    // return console.log(message)\n    //message = message.replace(/(<\\/span>|<span[^>]+?>)/g, '').replace(/(<\\/div>|<div[^>]*?>)/g, '').replace(/<br>/g, '').replace(/&nbsp;/g, ' ').replace(/</g, '&lt;').replace(/>/g, '&gt;')\n    if (message === '') return;\n    if (wss.status !== 'open') {\n      return this.setState({\n        messages: '与服务器断开连接'\n      })\n    }\n    this.props.sendingMessageAction(message)\n    wss.ws.send(JSON.stringify({\n      type: 'send_chat_message',\n      origin: this.props.user.userId,\n      target: this.props.chat.chatnow,\n      content: message\n    }))\n    this.refs.textarea.innerText = '' // 清空消息\n    this.props.setWaitMessageAction('')\n  }\n\n  // textareaFocus(e) {\n\n  // }\n  // textareaBlur(e) {\n\n  // }\n\n  textareaInput(e) {\n    this.props.setWaitMessageAction(e.target.innerHTML.trim().replace(/<div><br><\\/div>/g, ''))\n  }\n\n  textareaPress(e) {\n    var html = e.target.innerHTML\n    if (e.key === 'Enter') {\n      e.target.innerHTML = html.replace(/<div><br><\\/div>$/g, '')\n      this.sendMessage()\n    }\n  }\n\n  render() {\n    let chat = this.props.chat\n    let chatnow = undefined\n    if (chat.chatnow && Array.isArray(chat.messages)) {\n      chatnow = chat.messages.find(i => i.userId === chat.chatnow)\n    }\n    return (\n      <div className=\"chat-window\" style={{\n        display: chat.hideWindow ? 'none' : 'block'\n      }}>\n        <div className=\"chatw-header\">\n          <div onClick={this.swingChatWindow.bind(this)} className=\"charw-hide\" style={{\n            background: `url(${HOST}/image/ui/left.png) center center / 25px 25px no-repeat #628ef9`\n          }}></div>\n          <div className=\"chatw-h-targetname\">{chatnow && chatnow.nickname}</div>\n        </div>\n        <div className=\"chatw-show-scroll-wrap\">\n          <div ref=\"chatMessageBox\" className=\"chatw-show-wrap\">\n          {\n            [chatnow && chatnow.content.map((item, index) => (\n              <div className=\"chat-chatnow-wrap\" key={index}>\n                {\n                  item.sender === chatnow.userId ? (\n                    <div className=\"chat-target-wrap\">\n                      <div className=\"chat-target\" key=\"1\">\n                        <div className=\"chat-ta-avatar\" style={{\n                          background: `url(${HOST}/image/member/avatar/${chatnow.avatar}) center center / 30px 30px no-repeat`\n                        }}></div>\n                        <div className=\"chat-ta-nickname\">{chatnow.nickname}</div>\n                      </div>\n                      <div className=\"chat-msg-target\" dangerouslySetInnerHTML={{__html: transMessage(item.msg)}} key=\"2\"></div>\n                    </div>\n                  ) : (\n                    <div className=\"chat-me-wrap\">\n                      <div className=\"chat-me\" key=\"1\">\n                        <div className=\"chat-me-avatar\" style={{\n                          background: `url(${HOST}/image/member/avatar/${this.props.user.avatar}) center center / 30px 30px no-repeat`\n                        }}></div>\n                        <div className=\"chat-me-nickname\">{this.props.user.nickname}</div>\n                      </div>\n                      <div className=\"chat-msg-me\" dangerouslySetInnerHTML={{__html: transMessage(item.msg)}} key=\"2\"></div>\n                    </div>\n                  )\n                }\n              </div>\n            )),\n              chatnow && chat.sendingMessages.map((item, index) => {\n                return item.target !== chatnow.userId ? null : (\n                <div className=\"chat-chatnow-wrap\" key={index}>\n                  <div className=\"chat-me-wrap\">\n                    <div className=\"chat-me\" key=\"1\">\n                      <div className=\"chat-me-avatar\" style={{\n                        background: `url(${HOST}/image/member/avatar/${this.props.user.avatar}) center center / 30px 30px no-repeat`\n                      }}></div>\n                      <div className=\"chat-me-nickname\">{this.props.user.nickname}</div>\n                    </div>\n                    <div className=\"wait-msg-box\">\n                      <div className=\"chat-msg-me\" dangerouslySetInnerHTML={{__html: transMessage(item.message)}} key=\"2\"></div>\n                      <div className=\"wait-logo\"></div>\n                    </div>\n                  </div>\n                </div>\n              )})]\n          }\n          </div>\n        </div>\n        <div className=\"chatw-send-wrap\">\n          <div className=\"chatw-s-textarea\">\n            <div id=\"textarea\"\n              ref=\"textarea\"\n              // onFocus={this.textareaFocus.bind(this)}\n              // onBlur={this.textareaBlur.bind(this)}\n              onInput={this.textareaInput.bind(this)}\n              contentEditable={!!chatnow}\n              suppressContentEditableWarning=\"true\"\n              onKeyPress={this.textareaPress.bind(this)}\n              dangerouslySetInnerHTML={{__html: this.state.waitMessage}}\n            ></div>\n          </div>\n          <div className=\"chatw-s-sendbox\">\n            <div className=\"chat-add-img\">\n              <input onChange={this.chatImageChange.bind(this)} className=\"add-img-file\" type=\"file\"/>\n              <img src={`${HOST}/image/ui/plus-circle.png`} title=\"添加图片\"/>\n            </div>\n            {\n              this.state.message && <div className=\"char-err\">{this.state.message}</div>\n            }\n            <div onClick={this.sendMessage.bind(this)} className=\"chatw-s-sendbtn\">发送</div>\n\n          </div>\n        </div>\n        {\n          this.state.showChatImage && <div onClick={this.closeChatImage.bind(this)} className=\"chat-img-wrap\">\n            <img src={`${HOST}/image/member/chat/${this.state.chatImage}`}/>\n          </div>\n        }\n      </div>\n    )\n  }\n}\nfunction mapStateToProps(state) {\n  return {\n    user: state.auth.user,\n    chat: state.chat\n  }\n}\n\nChatWindow.propTypes = {\n  user: PropTypes.object.isRequired,\n  chat: PropTypes.object.isRequired,\n  setWaitMessageAction: PropTypes.func.isRequired,\n  swingChatWindowAction: PropTypes.func.isRequired\n}\nexport default connect(mapStateToProps, { swingChatWindowAction, setWaitMessageAction, sendingMessageAction })(ChatWindow)\n","/**\r\n * 在 App.js 中判断显示 store 中是否显示聊天功能，购物车点击青蛙显示\r\n * 请求消息记录，显示条数\r\n * 系统消息，用户消息\r\n */\r\nimport React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport config from '../../utils/config'\r\nimport PropTypes from 'prop-types'\r\nimport classnames from 'classnames'\r\n\r\nimport './index.scss'\r\nimport Message from './subpage/Message'\r\nimport Contacts from './subpage/Contacts'\r\nimport Search from './subpage/Search'\r\nimport ChatWindow from './subpage/ChatWindow'\r\n\r\nimport { initContacts } from '../../flux/actions/chatActions'\r\n\r\n\r\nconst HOST = config.HOST\r\n\r\nclass Chat extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      route: 'message',  // 显示 message，contacts，search\r\n      message: '',\r\n    }\r\n  }\r\n\r\n  componentWillMount() {\r\n\r\n  }\r\n\r\n  // componentDidMount() {\r\n  //   if (typeof(window) === 'object') {\r\n  //     var chat = document.getElementById('chat')\r\n  //     var chatMove = document.getElementById('chat-move')\r\n\r\n  //     chatMove.onmousedown = function(e) {\r\n  //       var startX = e.clientX\r\n  //       var startY = e.clientY\r\n  //       var top = parseInt(window.getComputedStyle(chat)['top'])\r\n  //       var left = parseInt(window.getComputedStyle(chat)['left'])\r\n  //       // var X = document.documentElement.clientWidth  // 窗口高宽\r\n  //       // var Y = document.documentElement.clientHeight\r\n  //       document.onmousemove = function(e) {\r\n  //         /**\r\n  //          * 判断将窗口拖出文档\r\n  //          */\r\n  //         chat.style.left = left + (e.clientX - startX) + 'px'\r\n  //         chat.style.top = top + (e.clientY - startY) + 'px'\r\n  //       }\r\n\r\n  //       document.onmouseup = function() {\r\n  //         // chat.onmousedown = null\r\n  //         document.onmousemove = null\r\n  //         document.onmouseup = null\r\n  //       }\r\n  //     }\r\n  //     document.onmouseleave = function() {\r\n  //         document.onmousemove = null\r\n  //         document.onmouseup = null\r\n  //     }\r\n  //   }\r\n  // }\r\n\r\n  // componentWillUnmount() {\r\n  //   if (typeof(window) === 'object') {\r\n  //     document.getElementById('chat-move').onmousedown = null\r\n  //     document.onmouseleave = null\r\n  //   }\r\n  // }\r\n\r\n  routeChange(route) {\r\n    this.setState({\r\n      route\r\n    })\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div id=\"chat\" style={{\r\n        width: this.props.hideWindow ? '280px' : '600px'\r\n      }}>\r\n        <div className=\"chat-route\">\r\n          <div id=\"chat-move\" className=\"cr-user-wrap\">\r\n            <div className=\"cr-user-avatar\" style={{\r\n              'background': `url(${HOST}/image/member/avatar/${this.props.auth.user.avatar}) center center / 30px 30px no-repeat`\r\n            }}></div>\r\n           <div className=\"cr-user-name\">{this.props.auth.user.nickname}</div>\r\n          </div>\r\n          <div className=\"cr-routes-wrap\">\r\n            <div onClick={this.routeChange.bind(this, 'message')} className={classnames(\"crr-item\", {\r\n              'crr-select-bg': this.state.route === 'message'\r\n            })}>\r\n              <div className=\"crr-item-img\"><img src={`${HOST}/image/ui/message.png`} /></div>\r\n              <div className=\"crr-item-f\"><span>消息</span></div>\r\n            </div>\r\n            <div onClick={this.routeChange.bind(this, 'contacts')} className={classnames(\"crr-item\", {\r\n              'crr-select-bg': this.state.route === 'contacts'\r\n            })}>\r\n              <div className=\"crr-item-img\"><img src={`${HOST}/image/ui/user.png`} /></div>\r\n              <div className=\"crr-item-f\"><span>联系人</span></div>\r\n            </div>\r\n            <div onClick={this.routeChange.bind(this, 'search')} className={classnames(\"crr-item\", {\r\n              'crr-select-bg': this.state.route === 'search'\r\n            })}>\r\n              <div className=\"crr-item-img\"><img src={`${HOST}/image/ui/monitor.png`} /></div>\r\n              <div className=\"crr-item-f\"><span>找人</span></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"chat-body\">\r\n          <div className=\"chat-body-box\">\r\n            {\r\n              !this.props.auth.isLogin ? <div className=\"warning-info\">请登录后操作！</div> :\r\n              this.state.route === 'message' ? <Message /> :\r\n              this.state.route === 'contacts' ? <Contacts /> :\r\n              this.state.route === 'search' ? <Search /> : null\r\n            }\r\n          </div>\r\n        </div>\r\n        <ChatWindow />\r\n      </div>\r\n    )\r\n  }\r\n}\r\nfunction mapStateToProps(state) {\r\n  return {\r\n    auth: state.auth,\r\n    hideWindow: state.chat.hideWindow\r\n    // chat: state.chat\r\n  }\r\n}\r\n\r\nChat.propTypes = {\r\n  auth: PropTypes.object.isRequired,\r\n  hideWindow: PropTypes.bool.isRequired\r\n  // chat: PropTypes.object.isRequired\r\n}\r\n\r\nexport default connect(mapStateToProps, { initContacts })(Chat)\r\n","import React from 'react';\r\nimport axios from 'axios'\r\nimport { Base64 } from 'js-base64'\r\n// import { connect } from 'react-redux'\r\n\r\nimport config from './utils/config.js'\r\n\r\nimport \"./App.scss\"\r\nimport Chat from './components/Chat'\r\n\r\nimport { setAuthToken, setCurrentUser } from './utils/setAuth'\r\nif (typeof(window) === 'object') {\r\n  var jwtToken;\r\n  if (window.__INITIAL_TOKEN__) {\r\n    try {\r\n      var split = window.__INITIAL_TOKEN__.split('.')\r\n      var payload = JSON.parse(Base64.decode(split[1]))\r\n      if (payload.exp * 1000 > Date.now()) {\r\n        jwtToken = window.__INITIAL_TOKEN__  // window 上的jwtToken\r\n      }else {\r\n        // 验证本地 token\r\n        jwtToken = window.localStorage.jwtToken;\r\n      }\r\n    }catch(err) {\r\n      console.error('tokenValidError', err.message)\r\n      jwtToken = window.localStorage.jwtToken;\r\n    }\r\n  }\r\n\r\n  if (jwtToken) {\r\n    axios.defaults.headers.common[\"Authorization\"] = jwtToken; // 设置请求头 token\r\n    // 验证请求头token\r\n    axios.get(`${config.HOST}/api/users/current`)\r\n      .then(res => {\r\n        if (!res.data.success) {\r\n          setAuthToken(false);\r\n          setCurrentUser({});\r\n        } else {\r\n          // token 验证成功\r\n          setAuthToken(res.data.payload.token);\r\n          setCurrentUser(res.data.payload.user);\r\n        }\r\n      })\r\n      .catch(err => {\r\n        setAuthToken(false);\r\n        setCurrentUser({});\r\n      });\r\n  }else {\r\n    setAuthToken(false);\r\n    setCurrentUser({});\r\n  }\r\n}\r\n\r\nconst App = (props) => {\r\n  return <Chat />\r\n}\r\n\r\n\r\nexport default App\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { Provider } from 'react-redux'\r\n\r\nimport App from './App';\r\nimport store from './flux/store'\r\n\r\nconst ReactBody = () => {\r\n  return (\r\n    <Provider store={store}>\r\n      <App />\r\n    </Provider>\r\n  )\r\n}\r\n// hydrate\r\nReactDOM.render(<ReactBody />, document.getElementById('react-body'));\r\n"],"sourceRoot":""}